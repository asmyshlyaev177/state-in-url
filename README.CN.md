[English](./README.md) | [í•œêµ­ì–´](./README.KO.md) | ç®€ä½“ä¸­æ–‡

<h1 align="center">state-in-url</h1>

<div align="center">
  <img src="/assets/logo.svg?raw=true" alt="åº“æ ‡å¿—"/>

  <div>è½»æ¾åœ¨ä¸ç›¸å…³çš„ React ç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€ï¼Œå…·æœ‰ IDE è‡ªåŠ¨å®Œæˆå’Œ TS éªŒè¯åŠŸèƒ½ã€‚æ— éœ€ä»»ä½•éº»çƒ¦æˆ–æ ·æ¿ä»£ç ã€‚</div>
</div>

<div align="center">
<hr />

[![npm](https://img.shields.io/npm/v/state-in-url.svg)](https://www.npmjs.com/package/state-in-url)
![Tests](https://github.com/asmyshlyaev177/state-in-url/actions/workflows/tests.yml/badge.svg?branch=main)
[![Codacy Badge](https://app.codacy.com/project/badge/Grade/73be54068b7f41b0b74a252579ac09ec)](https://app.codacy.com/gh/asmyshlyaev177/state-in-url/dashboard?utm_source=gh&utm_medium=referral&utm_content=&utm_campaign=Badge_grade)
[![Commitizen friendly](https://img.shields.io/badge/commitizen-friendly-brightgreen.svg)](https://github.com/asmyshlyaev177/state-in-url/)
![npm bundle size (minified + gzip)](https://img.shields.io/bundlephobia/minzip/state-in-url.svg)
</div>

<div align="center">

<h4 align="center">å¦‚æœå‘ç°bugï¼Œè¯·ä¸è¦çŠ¹è±«ï¼Œç«‹å³æå‡ºé—®é¢˜</h4>

![æ¼”ç¤º-gif](https://github.com/asmyshlyaev177/state-in-url/assets/19854148/c9802601-4d42-4362-b3e4-37ff87c3b97f)

<a href="https://state-in-url-asmyshlyaev177.vercel.app/" target="_blank">DEMO</a> |
<a href ="https://codesandbox.io/p/github/asmyshlyaev177/state-in-url/main?layout=%257B%2522sidebarPanel%2522%253A%2522EXPLORER%2522%252C%2522rootPanelGroup%2522%253A%257B%2522direction%2522%253A%2522horizontal%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522id%2522%253A%2522ROOT_LAYOUT%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522clyk5bd9y00062v6jspcfrkx7%2522%252C%2522sizes%2522%253A%255B100%252C0%255D%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522EDITOR%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522id%2522%253A%2522clyk5bd9x00022v6jyg71cr9e%2522%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522SHELLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522id%2522%253A%2522clyk5bd9x00042v6jsos2y043%2522%257D%255D%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522DEVTOOLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522id%2522%253A%2522clyk5bd9x00052v6j5r632b12%2522%257D%255D%257D%255D%252C%2522sizes%2522%253A%255B50%252C50%255D%257D%252C%2522tabbedPanels%2522%253A%257B%2522clyk5bd9x00022v6jyg71cr9e%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clyk5bd9w00012v6j83rq3bvo%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522FILE%2522%252C%2522filepath%2522%253A%2522%252FREADME.md%2522%252C%2522state%2522%253A%2522IDLE%2522%257D%255D%252C%2522id%2522%253A%2522clyk5bd9x00022v6jyg71cr9e%2522%252C%2522activeTabId%2522%253A%2522clyk5bd9w00012v6j83rq3bvo%2522%257D%252C%2522clyk5bd9x00052v6j5r632b12%2522%253A%257B%2522id%2522%253A%2522clyk5bd9x00052v6j5r632b12%2522%252C%2522activeTabId%2522%253A%2522clyk5bdjx000b2v6jfc8ae464%2522%252C%2522tabs%2522%253A%255B%257B%2522type%2522%253A%2522SETUP_TASKS%2522%252C%2522id%2522%253A%2522clyk5bdjx000b2v6jfc8ae464%2522%252C%2522mode%2522%253A%2522permanent%2522%257D%252C%257B%2522type%2522%253A%2522UNASSIGNED_PORT%2522%252C%2522port%2522%253A2222%252C%2522id%2522%253A%2522clyk5cjbo004d2v6j3u55k74g%2522%252C%2522mode%2522%253A%2522permanent%2522%257D%252C%257B%2522type%2522%253A%2522ENV_SETUP%2522%252C%2522id%2522%253A%2522clyk5h8dp000r2v6j0r7kc7qq%2522%252C%2522mode%2522%253A%2522permanent%2522%257D%255D%257D%252C%2522clyk5bd9x00042v6jsos2y043%2522%253A%257B%2522id%2522%253A%2522clyk5bd9x00042v6jsos2y043%2522%252C%2522activeTabId%2522%253A%2522clyk5cbuv001q2v6joegrxxv6%2522%252C%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clyk5bd9x00032v6jtfhj316o%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522NEW_TERMINAL%2522%257D%252C%257B%2522type%2522%253A%2522TASK_LOG%2522%252C%2522taskId%2522%253A%2522dev%2522%252C%2522id%2522%253A%2522clyk5cbuv001q2v6joegrxxv6%2522%252C%2522mode%2522%253A%2522permanent%2522%257D%252C%257B%2522type%2522%253A%2522TASK_LOG%2522%252C%2522taskId%2522%253A%2522cleanupDist%2522%252C%2522id%2522%253A%2522clyk5dgvo005i2v6jj950sxft%2522%252C%2522mode%2522%253A%2522permanent%2522%257D%255D%257D%257D%252C%2522showDevtools%2522%253Atrue%252C%2522showShells%2522%253Atrue%252C%2522showSidebar%2522%253Atrue%252C%2522sidebarPanelSize%2522%253A15%257D" target="_blank">Demo on Codesandbox</a>

<hr />

ç»™é¡¹ç›®åŠ ä¸ª â­ï¸ ä»¥ç¤ºæ”¯æŒï¼

<hr />

</div>

## ä¸ºä»€ä¹ˆä½¿ç”¨ state-in-url?

`state-in-url` æ˜¯ä¸€ä¸ªç®€å•çš„çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå…·æœ‰ URL åŒæ­¥åŠŸèƒ½ã€‚

# ä½¿ç”¨åœºæ™¯

- ğŸ™ƒ åœ¨ä¸æ”¹å˜ URL çš„æƒ…å†µä¸‹åœ¨ä¸åŒç»„ä»¶é—´å…±äº«çŠ¶æ€ï¼Œæ˜¯ä¿¡å·å’Œå…¶ä»–çŠ¶æ€ç®¡ç†å·¥å…·çš„è‰¯å¥½æ›¿ä»£å“
- ğŸ”— åŒ…å«å®Œæ•´åº”ç”¨ç¨‹åºçŠ¶æ€çš„å¯å…±äº« URL
- ğŸ”„ åœ¨é¡µé¢é‡æ–°åŠ è½½æ—¶è½»æ¾ä¿æŒçŠ¶æ€
- ğŸ§  åœ¨ä¸ç›¸å…³çš„å®¢æˆ·ç«¯ç»„ä»¶é—´åŒæ­¥æ•°æ®
- ğŸ§® åœ¨ URL ä¸­å­˜å‚¨æœªä¿å­˜çš„ç”¨æˆ·è¡¨å•

# ç‰¹æ€§

- ğŸ§© **ç®€å•**: æ— éœ€æä¾›è€…ã€å‡é€Ÿå™¨ã€æ ·æ¿ä»£ç æˆ–æ–°æ¦‚å¿µ
- ğŸ“˜ **TypeScript æ”¯æŒå’Œç±»å‹å®‰å…¨**: ä¿ç•™æ•°æ®ç±»å‹å’Œç»“æ„ï¼Œé€šè¿‡ IDE å»ºè®®ã€å¼ºç±»å‹å’Œ JSDoc æ³¨é‡Šå¢å¼ºå¼€å‘ä½“éªŒ
- âš›ï¸ **æ¡†æ¶çµæ´»æ€§**: ä¸º Next.js å’Œ React.js åº”ç”¨ç¨‹åºæä¾›å•ç‹¬çš„é’©å­ï¼Œä»¥åŠçº¯ JS å‡½æ•°
- âš™ **æµ‹è¯•å……åˆ†**: å•å…ƒæµ‹è¯•å’Œ Playwright æµ‹è¯•
- âš¡ **å¿«é€Ÿ**: æœ€å°åŒ–é‡æ–°æ¸²æŸ“
- ğŸª¶ **è½»é‡çº§**: é›¶ä¾èµ–ï¼Œå ç”¨ç©ºé—´å°

## ç›®å½•

- [å®‰è£…](#å®‰è£…)
- [Next.js çš„ `useUrlState`](#nextjs-çš„-useurlstate-é’©å­)
- [React.js çš„ `useUrlEncode`](#reactjs-çš„-useurlencode-é’©å­)
- [çº¯ JS ä½¿ç”¨çš„ `encodeState` å’Œ `decodeState`](#çº¯-js-ä½¿ç”¨çš„-encodestate-å’Œ-decodestate-è¾…åŠ©å‡½æ•°)
- [è‡ªåŠ¨åŒæ­¥çŠ¶æ€åˆ° URL](#è‡ªåŠ¨åŒæ­¥çŠ¶æ€)
- [ä½çº§ `encode` å’Œ `decode` å‡½æ•°](#encode-å’Œ-decode-è¾…åŠ©å‡½æ•°)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
- [è”ç³»ä¸æ”¯æŒ](#è”ç³»ä¸æ”¯æŒ)
- [æ›´æ–°æ—¥å¿—](#æ›´æ–°æ—¥å¿—)
- [è®¸å¯è¯](#è®¸å¯è¯)
- [çµæ„Ÿæ¥æº](#çµæ„Ÿæ¥æº)

## å®‰è£…

### 1. å®‰è£…åŒ…

```sh
# npm
npm install --save state-in-url
# yarn
yarn add state-in-url
# pnpm
pnpm add state-in-url
```

### 2. ç¼–è¾‘ tsconfig.json

åœ¨ `tsconfig.json` ä¸­è®¾ç½® `"moduleResolution": "Node16"` æˆ– `"moduleResolution": "NodeNext"`

## Next.js çš„ useUrlState é’©å­

[æ–‡æ¡£](packages/urlstate/useUrlState/README.md)

`useUrlState` æ˜¯ä¸€ä¸ªä¸º Next.js åº”ç”¨ç¨‹åºè®¾è®¡çš„è‡ªå®šä¹‰ React é’©å­ï¼Œä½¿å®¢æˆ·ç«¯ç»„ä»¶ä¹‹é—´çš„é€šä¿¡å˜å¾—ç®€å•ã€‚å®ƒå…è®¸ä½ å…±äº«ä»»ä½•å¤æ‚çš„çŠ¶æ€å¹¶å°†å…¶ä¸ URL æœç´¢å‚æ•°åŒæ­¥ï¼Œæä¾›äº†ä¸€ç§åœ¨é¡µé¢é‡æ–°åŠ è½½æ—¶ä¿æŒçŠ¶æ€å’Œé€šè¿‡ URL å…±äº«åº”ç”¨ç¨‹åºçŠ¶æ€çš„æ–¹æ³•ã€‚

### ä½¿ç”¨ç¤ºä¾‹

#### åŸºæœ¬ç”¨æ³•

1. å®šä¹‰çŠ¶æ€å½¢çŠ¶

   ```typescript
   // countState.ts
   // çŠ¶æ€å½¢çŠ¶åº”è¯¥å­˜å‚¨åœ¨ä¸€ä¸ªå¸¸é‡ä¸­ï¼Œä¸è¦ç›´æ¥ä¼ é€’å¯¹è±¡
   export const countState: CountState = { count: 0 }

   type CountState = { count: number }
   ```

2. å¯¼å…¥å¹¶ä½¿ç”¨

```typescript
'use client'
import { useUrlState } from 'state-in-url';

import { countState } from './countState';

function MyComponent() {
  // ç”¨äºä»æœåŠ¡å™¨ç»„ä»¶ä½¿ç”¨ searchParams
  // ä¾‹å¦‚ export default async function Home({ searchParams }: { searchParams: object }) {
  // const { state, updateState, updateUrl } = useUrlState(countState, searchParams);
  const { state, updateState, updateUrl } = useUrlState(countState);

  // ä¸ä¼šè®©ä½ æ„å¤–åœ°ç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼Œéœ€è¦ TS
  // state.count = 2 // <- é”™è¯¯

  return (
    <div>
      <p>è®¡æ•°: {state.count}</p>

      <button onClick={() => updateUrl({ count: state.count + 1 }), { replace: true }}>
        å¢åŠ  (æ›´æ–° URL)
      </button>

      // ä¸ React.useState ç›¸åŒçš„ API
      <button onClick={() => updateState(currState => ({...currState, count: currState.count + 1 }) )}>
        å¢åŠ  (ä»…æœ¬åœ°)
      </button>
      <button onClick={() => updateUrl()}>
        åŒæ­¥æ›´æ”¹åˆ° URL
        // æˆ–è€…ä¸åŒæ­¥ï¼Œåªå…±äº«çŠ¶æ€
      </button>

      <button onClick={() => updateUrl(state)}>
        é‡ç½®
      </button>
    </div>
  )
}
```

#### å¤æ‚çŠ¶æ€å½¢çŠ¶ç¤ºä¾‹

```typescript
interface UserSettings {
  theme: 'light' | 'dark';
  fontSize: number;
  notifications: boolean;
}

export const userSettings: UserSettings {
  theme: 'light',
  fontSize: 16,
  notifications: true,
}
```

```typescript
'use client'
import { useUrlState } from 'state-in-url';

import { userSettings } from './userSettings';

function SettingsComponent() {
  // `state` å°†ä» UserSettings ç±»å‹æ¨æ–­!
  const { state, updateUrl } = useUrlState(userSettings);

  const toggleTheme = () => {
    updateUrl(current => ({
      ...current,
      theme: current.theme === 'light' ? 'dark' : 'light',
    }));
  };

  // ç©ºé—²æ—¶åŒæ­¥çŠ¶æ€åˆ° url
  const timer = React.useRef(0 as unknown as NodeJS.Timeout);
  React.useEffect(() => {
    clearTimeout(timer.current);
    timer.current = setTimeout(() => {
      // å°†æŒ‰å†…å®¹è€Œä¸æ˜¯å¼•ç”¨æ¯”è¾ƒçŠ¶æ€ï¼Œå¹¶ä»…å¯¹æ–°å€¼è§¦å‘æ›´æ–°
      updateUrl(state);
    }, 500);

    return () => {
      clearTimeout(timer.current);
    };
  }, [state, updateUrl]);

  return (
    <div>
      <h2>ç”¨æˆ·è®¾ç½®</h2>
      <p>ä¸»é¢˜: {state.theme}</p>
      <p>å­—ä½“å¤§å°: {state.fontSize}px</p>
      <button onClick={toggleTheme}>åˆ‡æ¢ä¸»é¢˜</button>
      {/* å…¶ä»–ç”¨äºæ›´æ–°å…¶ä»–è®¾ç½®çš„ UI å…ƒç´  */}
    </div>
  );
}
...

// å…¶ä»–ç»„ä»¶
function Component() {
  const { state } = useUrlState(defaultSettings);

  return (
    <div>
      <p>é€šçŸ¥åŠŸèƒ½ {state.notifications ? 'å¼€å¯' : 'å…³é—­'}</p>
    </div>
  )
}
```

#### è‡ªåŠ¨åŒæ­¥çŠ¶æ€

```typescript
  const timer = React.useRef(0 as unknown as NodeJS.Timeout);
  React.useEffect(() => {
    clearTimeout(timer.current);
    timer.current = setTimeout(() => {
      // å°†æŒ‰å†…å®¹è€Œä¸æ˜¯å¼•ç”¨æ¯”è¾ƒçŠ¶æ€ï¼Œå¹¶ä»…å¯¹æ–°å€¼è§¦å‘æ›´æ–°
      updateUrl(state);
    }, 500);

    return () => {
      clearTimeout(timer.current);
    };
  }, [state, updateUrl]);
```

#### ä»»æ„çŠ¶æ€å½¢çŠ¶ (ä¸æ¨è)

```typescript
'use client'
import { useUrlState } from 'state-in-url';

const someObj = {};

function SettingsComponent() {
  const { state, updateUrl, updateState } = useUrlState<object>(someObj);
}
```

## React.js çš„ `useUrlEncode` é’©å­

[æ–‡æ¡£](packages/urlstate/useUrlEncode/README.md)

## çº¯ JS ä½¿ç”¨çš„ `encodeState` å’Œ `decodeState` è¾…åŠ©å‡½æ•°

[æ–‡æ¡£](packages/urlstate/encodeState/README.md)

## `encode` å’Œ `decode` è¾…åŠ©å‡½æ•°

[æ–‡æ¡£](packages/urlstate/encoder/README.md)

## æœ€ä½³å®è·µ

- å°†çŠ¶æ€å½¢çŠ¶å®šä¹‰ä¸ºå¸¸é‡ä»¥ç¡®ä¿ä¸€è‡´æ€§
- ä½¿ç”¨ TypeScript ä»¥å¢å¼ºç±»å‹å®‰å…¨æ€§å’Œè‡ªåŠ¨å®ŒæˆåŠŸèƒ½
- é¿å…åœ¨ URL å‚æ•°ä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- å¯¹é¢‘ç¹æ›´æ–°ä½¿ç”¨ `updateState`ï¼Œä½¿ç”¨ `updateUrl` åŒæ­¥æ›´æ”¹åˆ° url
- ä½¿ç”¨æ­¤[æ‰©å±•](https://marketplace.visualstudio.com/items?itemName=yoavbls.pretty-ts-errors)ä»¥è·å¾—å¯è¯»çš„ TS é”™è¯¯

## æ³¨æ„äº‹é¡¹

1. åªèƒ½ä¼ é€’å¯åºåˆ—åŒ–çš„å€¼ï¼Œ`Function`ã€`BigInt` æˆ– `Symbol` ä¸èµ·ä½œç”¨ï¼Œ`ArrayBuffer` ä¹‹ç±»çš„ä¸œè¥¿ä¹Ÿå¯èƒ½ä¸è¡Œã€‚
2. Vercel æœåŠ¡å™¨å°†å¤´éƒ¨å¤§å°ï¼ˆæŸ¥è¯¢å­—ç¬¦ä¸²å’Œå…¶ä»–å†…å®¹ï¼‰é™åˆ¶ä¸º **14KB**ï¼Œå› æ­¤è¯·å°† URL çŠ¶æ€ä¿æŒåœ¨çº¦ 5000 å­—ä»¥å†…ã€‚ https://vercel.com/docs/errors/URL_TOO_LONG

## æœ¬åœ°è¿è¡Œ

å…‹éš†æ­¤ä»“åº“ï¼Œè¿è¡Œ `npm install` ç„¶å

```sh
npm run dev
```

è½¬åˆ° [localhost:3000](http://localhost:3000)

## è”ç³»ä¸æ”¯æŒ

- åˆ›å»º [GitHub issue](https://github.com/asmyshlyaev177/state-in-url/issues) ä»¥æŠ¥å‘Šé”™è¯¯ã€è¯·æ±‚åŠŸèƒ½æˆ–æå‡ºé—®é¢˜

## [æ›´æ–°æ—¥å¿—](https://github.com/asmyshlyaev177/state-in-url/blob/main/CHANGELOG.md)

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](https://github.com/asmyshlyaev177/state-in-url/blob/main/LICENSE)ã€‚

## çµæ„Ÿæ¥æº

[åœ¨ Vue ä¸­ä½¿ç”¨ URL å­˜å‚¨çŠ¶æ€](https://dev.to/jacobandrewsky/using-url-to-store-state-in-vue-275c)

[åœ¨ URL ä¸­å­˜å‚¨çŠ¶æ€](https://antonz.org/storing-state/)

[NextJS useSearchParams](https://nextjs.org/docs/app/api-reference/functions/use-search-params)
