[English](./README.md) | [í•œêµ­ì–´](./README.KO.md) | ç®€ä½“ä¸­æ–‡

<div align="center">
  <img src="/assets/Logo_big.png?raw=true" alt="state-in-url logo"/>

  <div>è½»æ¾åœ¨ä¸ç›¸å…³çš„Reactç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€ï¼Œå…·æœ‰IDEè‡ªåŠ¨å®Œæˆå’ŒTSéªŒè¯åŠŸèƒ½ã€‚æ— éœ€ä»»ä½•éº»çƒ¦æˆ–æ ·æ¿ä»£ç ã€‚</div>
</div>

<div align="center">
<hr />

[![npm](https://img.shields.io/npm/v/state-in-url.svg)](https://www.npmjs.com/package/state-in-url)
![Tests](https://github.com/asmyshlyaev177/state-in-url/actions/workflows/tests.yml/badge.svg?branch=master)
[![Codacy Badge](https://app.codacy.com/project/badge/Grade/73be54068b7f41b0b74a252579ac09ec)](https://app.codacy.com/gh/asmyshlyaev177/state-in-url/dashboard?utm_source=gh&utm_medium=referral&utm_content=&utm_campaign=Badge_grade)
[![Commitizen friendly](https://img.shields.io/badge/commitizen-friendly-brightgreen.svg)](https://github.com/asmyshlyaev177/state-in-url/)
![npm bundle size (minified + gzip)](https://img.shields.io/bundlephobia/minzip/state-in-url.svg)
</div>

<div align="center">

<h4 align="center">å¦‚æœå‘ç°bugï¼Œè¯·éšæ—¶æå‡ºissue</h4>

![æ¼”ç¤º-gif](https://github.com/asmyshlyaev177/state-in-url/assets/19854148/c9802601-4d42-4362-b3e4-37ff87c3b97f)

<a href="https://state-in-url.dev/" target="_blank">æ¼”ç¤º</a> |
<a href="https://state-in-url.netlify.app/" target="_blank">DEMO2</a> |

<hr />

æ·»åŠ â­ï¸æ¥æ”¯æŒé¡¹ç›®ï¼

<hr />

</div>

## ä¸ºä»€ä¹ˆä½¿ç”¨state-in-urlï¼Ÿ

`state-in-url`æ˜¯ä¸€ä¸ªç®€å•çš„çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ä¸URLåŒæ­¥ã€‚åœ¨ä¸ç›¸å…³çš„Reactç»„ä»¶ä¹‹é—´å…±äº«å¤æ‚çŠ¶æ€ï¼Œå°†çŠ¶æ€åŒæ­¥åˆ°URLï¼Œå¯¹TSå‹å¥½ï¼Œå…¼å®¹NextJSã€‚

# ä½¿ç”¨åœºæ™¯

- ğŸ™ƒ åœ¨ä¸æ”¹å˜URLçš„æƒ…å†µä¸‹ï¼Œåœ¨ä¸åŒç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€ï¼Œæ˜¯ä¿¡å·å’Œå…¶ä»–çŠ¶æ€ç®¡ç†å·¥å…·çš„è‰¯å¥½æ›¿ä»£æ–¹æ¡ˆ
- ğŸ”— åŒ…å«å®Œæ•´åº”ç”¨ç¨‹åºçŠ¶æ€çš„å¯å…±äº«URL
- ğŸ”„ åœ¨é¡µé¢é‡æ–°åŠ è½½ä¹‹é—´è½»æ¾æŒä¹…åŒ–çŠ¶æ€
- ğŸ§  åœ¨ä¸ç›¸å…³çš„å®¢æˆ·ç«¯ç»„ä»¶ä¹‹é—´åŒæ­¥æ•°æ®
- ğŸ§® åœ¨URLä¸­å­˜å‚¨æœªä¿å­˜çš„ç”¨æˆ·è¡¨å•

# ç‰¹æ€§

- ğŸ§© **ç®€å•**ï¼šæ— éœ€æä¾›è€…ã€reducersã€æ ·æ¿ä»£ç æˆ–æ–°æ¦‚å¿µ
- ğŸ“˜ **TypeScriptæ”¯æŒå’Œç±»å‹å®‰å…¨**ï¼šä¿ç•™æ•°æ®ç±»å‹å’Œç»“æ„ï¼Œé€šè¿‡IDEå»ºè®®ã€å¼ºç±»å‹å’ŒJSDocæ³¨é‡Šå¢å¼ºå¼€å‘ä½“éªŒ
- âš›ï¸ **æ¡†æ¶çµæ´»æ€§**ï¼šä¸ºNext.jså’ŒReact.jsåº”ç”¨ç¨‹åºæä¾›å•ç‹¬çš„é’©å­ï¼Œä»¥åŠç”¨äºçº¯JSçš„å‡½æ•°
- âš™ **ç»è¿‡å……åˆ†æµ‹è¯•**ï¼šå•å…ƒæµ‹è¯•å’ŒPlaywrightæµ‹è¯•
- âš¡ **å¿«é€Ÿ**ï¼šæœ€å°‘çš„é‡æ–°æ¸²æŸ“
- ğŸª¶ **è½»é‡çº§**ï¼šé›¶ä¾èµ–ï¼Œå ç”¨ç©ºé—´å°

## ç›®å½•

- [å®‰è£…](#å®‰è£…)
- [Next.jsçš„`useUrlState`](#nextjsçš„useurlstateé’©å­)
- [React.jsçš„`useSharedState`](#reactjsçš„usesharedstateé’©å­)
- [React.jsçš„`useUrlEncode`](#reactjsçš„useurlencodeé’©å­)
- [çº¯JSä½¿ç”¨çš„`encodeState`å’Œ`decodeState`](#çº¯jsä½¿ç”¨çš„encodestateå’Œdecodestateè¾…åŠ©å‡½æ•°)
- [è‡ªåŠ¨åŒæ­¥çŠ¶æ€åˆ°URL](#è‡ªåŠ¨åŒæ­¥çŠ¶æ€)
- [ä½çº§`encode`å’Œ`decode`å‡½æ•°](#encodeå’Œdecodeè¾…åŠ©å‡½æ•°)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
- [è”ç³»ä¸æ”¯æŒ](#è”ç³»ä¸æ”¯æŒ)
- [æ›´æ–°æ—¥å¿—](#æ›´æ–°æ—¥å¿—)
- [è®¸å¯è¯](#è®¸å¯è¯)
- [çµæ„Ÿæ¥æº](#çµæ„Ÿæ¥æº)

## å®‰è£…

### 1. å®‰è£…åŒ…

```sh
# npm
npm install --save state-in-url
# yarn
yarn add state-in-url
# pnpm
pnpm add state-in-url
```

### 2. ç¼–è¾‘tsconfig.json

åœ¨`tsconfig.json`çš„`compilerOptions`ä¸­è®¾ç½®`"moduleResolution": "Node16"`æˆ–`"moduleResolution": "NodeNext"`

## Next.jsçš„useUrlStateé’©å­

[æ–‡æ¡£](packages/urlstate/next/useUrlState)

`useUrlState`æ˜¯ä¸€ä¸ªä¸ºNext.jsåº”ç”¨ç¨‹åºè®¾è®¡çš„è‡ªå®šä¹‰Reacté’©å­ï¼Œä½¿å®¢æˆ·ç«¯ç»„ä»¶ä¹‹é—´çš„é€šä¿¡å˜å¾—ç®€å•ã€‚å®ƒå…è®¸ä½ å…±äº«ä»»ä½•å¤æ‚çš„çŠ¶æ€å¹¶å°†å…¶ä¸URLæœç´¢å‚æ•°åŒæ­¥ï¼Œæä¾›äº†ä¸€ç§åœ¨é¡µé¢é‡æ–°åŠ è½½ä¹‹é—´æŒä¹…åŒ–çŠ¶æ€å¹¶é€šè¿‡URLå…±äº«åº”ç”¨ç¨‹åºçŠ¶æ€çš„æ–¹æ³•ã€‚

### ä½¿ç”¨ç¤ºä¾‹

#### åŸºæœ¬ç”¨æ³•

1. å®šä¹‰çŠ¶æ€å½¢çŠ¶

   ```typescript
   // countState.ts
   // çŠ¶æ€å½¢çŠ¶åº”è¯¥å­˜å‚¨åœ¨ä¸€ä¸ªå¸¸é‡ä¸­ï¼Œä¸è¦ç›´æ¥ä¼ é€’å¯¹è±¡
   export const countState: CountState = { count: 0 }

   type CountState = { count: number }
   ```

2. å¯¼å…¥å¹¶ä½¿ç”¨

```typescript
'use client'
import { useUrlState } from 'state-in-url/next';

import { countState } from './countState';

function MyComponent() {
  // ç”¨äºä»æœåŠ¡å™¨ç»„ä»¶ä½¿ç”¨searchParams
  // ä¾‹å¦‚ export default async function Home({ searchParams }: { searchParams: object }) {
  // const { state, updateState, updateUrl } = useUrlState(countState, searchParams);
  const { state, updateState, updateUrl } = useUrlState(countState);

  // ä¸å…è®¸ä½ æ„å¤–åœ°ç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼Œéœ€è¦TS
  // state.count = 2 // <- é”™è¯¯

  return (
    <div>
      <p>è®¡æ•°ï¼š{state.count}</p>

      <button onClick={() => updateUrl({ count: state.count + 1 }), { replace: true }}>
        å¢åŠ ï¼ˆæ›´æ–°URLï¼‰
      </button>

      // ä¸React.useStateç›¸åŒçš„API
      <button onClick={() => updateState(currState => ({...currState, count: currState.count + 1 }) )}>
        å¢åŠ ï¼ˆä»…æœ¬åœ°ï¼‰
      </button>
      <button onClick={() => updateUrl()}>
        åŒæ­¥æ›´æ”¹åˆ°URL
        // æˆ–è€…ä¸åŒæ­¥ï¼Œåªå…±äº«çŠ¶æ€
      </button>

      <button onClick={() => updateUrl(state)}>
        é‡ç½®
      </button>
    </div>
  )
}
```

#### å¤æ‚çŠ¶æ€å½¢çŠ¶ç¤ºä¾‹

```typescript
interface UserSettings {
  theme: 'light' | 'dark';
  fontSize: number;
  notifications: boolean;
}

export const userSettings: UserSettings {
  theme: 'light',
  fontSize: 16,
  notifications: true,
}
```

```typescript
'use client'
import { useUrlState } from 'state-in-url/next';

import { userSettings } from './userSettings';

function SettingsComponent() {
  // `state` å°†ä»UserSettingsç±»å‹æ¨æ–­ï¼
  const { state, updateUrl } = useUrlState(userSettings);

  const toggleTheme = () => {
    updateUrl(current => ({
      ...current,
      theme: current.theme === 'light' ? 'dark' : 'light',
    }));
  };

  // ç©ºé—²æ—¶åŒæ­¥çŠ¶æ€åˆ°URL
  const timer = React.useRef(0 as unknown as NodeJS.Timeout);
  React.useEffect(() => {
    clearTimeout(timer.current);
    timer.current = setTimeout(() => {
      // å°†é€šè¿‡å†…å®¹è€Œä¸æ˜¯å¼•ç”¨æ¯”è¾ƒçŠ¶æ€ï¼Œåªä¸ºæ–°å€¼è§¦å‘æ›´æ–°
      updateUrl(state);
    }, 500);

    return () => {
      clearTimeout(timer.current);
    };
  }, [state, updateUrl]);

  return (
    <div>
      <h2>ç”¨æˆ·è®¾ç½®</h2>
      <p>ä¸»é¢˜ï¼š{state.theme}</p>
      <p>å­—ä½“å¤§å°ï¼š{state.fontSize}px</p>
      <button onClick={toggleTheme}>åˆ‡æ¢ä¸»é¢˜</button>
      {/* å…¶ä»–UIå…ƒç´ ç”¨äºæ›´æ–°å…¶ä»–è®¾ç½® */}
    </div>
  );
}
...

// å…¶ä»–ç»„ä»¶
function Component() {
  const { state } = useUrlState(defaultSettings);

  return (
    <div>
      <p>é€šçŸ¥ {state.notifications ? 'å¼€å¯' : 'å…³é—­'}</p>
    </div>
  )
}
```

#### è‡ªåŠ¨åŒæ­¥çŠ¶æ€

```typescript
  const timer = React.useRef(0 as unknown as NodeJS.Timeout);
  React.useEffect(() => {
    clearTimeout(timer.current);
    timer.current = setTimeout(() => {
      // å°†é€šè¿‡å†…å®¹è€Œä¸æ˜¯å¼•ç”¨æ¯”è¾ƒçŠ¶æ€ï¼Œåªä¸ºæ–°å€¼è§¦å‘æ›´æ–°
      updateUrl(state);
    }, 500);

    return () => {
      clearTimeout(timer.current);
    };
  }, [state, updateUrl]);
```

#### æœåŠ¡å™¨ç«¯æ¸²æŸ“ç¤ºä¾‹

```typescript
export default async function Home({ searchParams }: { searchParams: object }) {
  return (
    <Form sp={searchParams} />
  )
}

// Form.tsx
'use client'
import React from 'react';
import { useUrlState } from 'state-in-url/next';
import { form } from './form';

const Form = ({ sp }: { sp: object }) => {
  const { state, updateState, updateUrl } = useUrlState(form, sp);
}
```

#### åœ¨`layout`ç»„ä»¶ä¸­ä½¿ç”¨é’©å­

è¿™æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„éƒ¨åˆ†ï¼Œå› ä¸ºä½¿ç”¨app routerçš„nextjsä¸å…è®¸ä»æœåŠ¡å™¨ç«¯è®¿é—®searchParamsã€‚æœ‰ä¸€ä¸ªä½¿ç”¨ä¸­é—´ä»¶çš„è§£å†³æ–¹æ³•ï¼Œä½†å®ƒå¹¶ä¸æ¼‚äº®ï¼Œè€Œä¸”å¯èƒ½åœ¨nextjsæ›´æ–°ååœæ­¢å·¥ä½œã€‚

```typescript
// æ·»åŠ åˆ°é€‚å½“çš„`layout.tsc`
export const runtime = 'edge';

// middleware.ts
import type { NextRequest } from 'next/server';
import { NextResponse } from 'next/server';

export function middleware(request: NextRequest) {
  const url = request.url?.includes('_next') ? null : request.url;
  const sp = url?.split?.('?')?.[1] || '';

  const response = NextResponse.next();

  if (url !== null) {
    response.headers.set('searchParams', sp);
  }

  return response;
}

// ç›®æ ‡layoutç»„ä»¶
import { headers } from 'next/headers';
import { decodeState } from 'state-in-url/encodeState';

export default async function Layout({
  children,
}: {
  children: React.ReactNode;
}) {
  const sp = headers().get('searchParams') || '';

  return (
    <div>
      <Comp1 searchParams={decodeState(sp, stateShape)} />
      {children}
    </div>
  );
}
```

#### ä»»æ„çŠ¶æ€å½¢çŠ¶ç¤ºä¾‹ï¼ˆä¸æ¨èï¼‰

```typescript
'use client'
import { useUrlState } from 'state-in-url/next';

const someObj = {};

function SettingsComponent() {
  const { state, updateUrl, updateState } = useUrlState<object>(someObj);
}
```

## React.jsçš„`useSharedState`é’©å­
ç”¨äºåœ¨ä»»ä½•Reactç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€çš„é’©å­ï¼Œå·²åœ¨Next.jså’ŒViteä¸­æµ‹è¯•ã€‚

```typescript
'use client'
import { useSharedState } from 'state-in-url';

export const someState = { name: '' };

function SettingsComponent() {
  const { state, setState } = useSharedState(someState);
}
```

[æ–‡æ¡£](packages/urlstate/useSharedState/README.md)

## React.jsçš„`useUrlEncode`é’©å­

[æ–‡æ¡£](packages/urlstate/useUrlEncode/README.md)

## çº¯JSä½¿ç”¨çš„`encodeState`å’Œ`decodeState`è¾…åŠ©å‡½æ•°

[æ–‡æ¡£](packages/urlstate/encodeState/README.md)

## `encode`å’Œ`decode`è¾…åŠ©å‡½æ•°

[æ–‡æ¡£](packages/urlstate/encoder/README.md)

## æœ€ä½³å®è·µ

- å°†æ‚¨çš„çŠ¶æ€å½¢çŠ¶å®šä¹‰ä¸ºå¸¸é‡ï¼Œä»¥ç¡®ä¿ä¸€è‡´æ€§
- ä½¿ç”¨TypeScriptä»¥å¢å¼ºç±»å‹å®‰å…¨æ€§å’Œè‡ªåŠ¨å®ŒæˆåŠŸèƒ½
- é¿å…åœ¨URLå‚æ•°ä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- ä½¿ç”¨`updateState`è¿›è¡Œé¢‘ç¹æ›´æ–°ï¼Œä½¿ç”¨`updateUrl`åŒæ­¥æ›´æ”¹åˆ°URL
- åœ¨Next.jsä¸­ä½¿ç”¨`Suspence`åŒ…è£…å®¢æˆ·ç«¯ç»„ä»¶
- ä½¿ç”¨è¿™ä¸ª[æ‰©å±•](https://marketplace.visualstudio.com/items?itemName=yoavbls.pretty-ts-errors)ä»¥è·å¾—å¯è¯»çš„TSé”™è¯¯

## æ³¨æ„äº‹é¡¹

1. åªèƒ½ä¼ é€’å¯åºåˆ—åŒ–çš„å€¼ï¼Œ`Function`ã€`BigInt`æˆ–`Symbol`ä¸ä¼šå·¥ä½œï¼Œå¯èƒ½ç±»ä¼¼`ArrayBuffer`çš„ä¸œè¥¿ä¹Ÿä¸è¡Œã€‚
2. VercelæœåŠ¡å™¨é™åˆ¶å¤´éƒ¨ï¼ˆæŸ¥è¯¢å­—ç¬¦ä¸²å’Œå…¶ä»–å†…å®¹ï¼‰çš„å¤§å°ä¸º**14KB**ï¼Œæ‰€ä»¥ä¿æŒæ‚¨çš„URLçŠ¶æ€åœ¨~5000ä¸ªå•è¯ä»¥ä¸‹ã€‚https://vercel.com/docs/errors/URL_TOO_LONG
3. å·²åœ¨ä½¿ç”¨app routerçš„`next.js` 14ä¸­æµ‹è¯•ï¼Œä¸è®¡åˆ’æ”¯æŒpagesã€‚

## æœ¬åœ°è¿è¡Œ

å…‹éš†æ­¤ä»“åº“ï¼Œè¿è¡Œ`npm install`ç„¶å

```sh
npm run dev
```

è½¬åˆ°[localhost:3000](http://localhost:3000)

## è”ç³»ä¸æ”¯æŒ

- åˆ›å»º[GitHub issue](https://github.com/asmyshlyaev177/state-in-url/issues)æŠ¥å‘Šbugã€æå‡ºåŠŸèƒ½è¯·æ±‚æˆ–æé—®

## [æ›´æ–°æ—¥å¿—](https://github.com/asmyshlyaev177/state-in-url/blob/master/CHANGELOG.md)

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨[MITè®¸å¯è¯](https://github.com/asmyshlyaev177/state-in-url/blob/master/LICENSE)ã€‚

## çµæ„Ÿæ¥æº

[åœ¨Vueä¸­ä½¿ç”¨URLå­˜å‚¨çŠ¶æ€](https://dev.to/jacobandrewsky/using-url-to-store-state-in-vue-275c)

[åœ¨URLä¸­å­˜å‚¨çŠ¶æ€](https://antonz.org/storing-state/)

[NextJS useSearchParams](https://nextjs.org/docs/app/api-reference/functions/use-search-params)
