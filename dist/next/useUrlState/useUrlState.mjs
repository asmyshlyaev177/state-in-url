import r from"react";import{useRouter as C,useSearchParams as H}from"next/navigation";import{parseSPObj as d}from"../../parseSPObj.mjs";import{useUrlStateBase as g}from"../../useUrlStateBase/useUrlStateBase.mjs";import{routerHistory as U,filterUnknownParams as h,isSSR as v,filterUnknownParamsClient as w}from"../../utils.mjs";function E(t,s){const a="defaultState"in t?t.defaultState:t,c="defaultState"in t?t.searchParams:s?.searchParams,l="defaultState"in t?t.useHistory:s?.useHistory,P="defaultState"in t?{scroll:t.scroll,replace:t.replace}:{scroll:s?.scroll,replace:s?.replace},u=C(),b=r.useMemo(()=>({push:(...e)=>{l===void 0||l?U.push(...e):u.push(...e)},replace:(...e)=>{l===void 0||l?U.replace(...e):u.replace(...e)}}),[u]),{state:p,updateState:o,updateUrl:i,reset:n,getState:k}=g(a,b,({parse:e})=>v?d(h(a,c),a):e(w(a,c))),m=r.useMemo(()=>({...M,...P}),[]),f=r.useCallback((e,j)=>i(e,{...m,...j}),[i]),S=H();r.useLayoutEffect(()=>{o(h(a,d(Object.fromEntries([...S.entries()]),a)))},[S]);const y=r.useCallback(e=>{n({...m,...e})},[n]);return{setState:o,updateState:o,setUrl:f,updateUrl:f,urlState:p,state:p,reset:y,getState:k}}const M={replace:!0,scroll:!1};export{E as useUrlState};
