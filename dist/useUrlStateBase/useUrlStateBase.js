"use strict";var _=require("react");var y=require("../constants/constants.js");var L=require("../useInsertionEffect.js");var P=require("../useSharedState/useSharedState.js");var T=require("../useUrlEncode/useUrlEncode.js");var i=require("../utils.js");function b(t){return t&&t.__esModule?t:{default:t}}var v=b(_);let s;function B(t,e,l,d){const{parse:r,stringify:a}=T.useUrlEncode(t);const{state:f,getState:c,setState:o}=P.useSharedState(t,()=>l?.({parse:r})||t);L.useInsertionEffect(()=>{const n=()=>{const h=r(i.filterUnknownParamsClient(t,i.getSearch()));o(h)};window.addEventListener(i.popstateEv,n);return()=>{window.removeEventListener(i.popstateEv,n)}},[]);const w=v.default.useRef([]);const p=v.default.useCallback((n,h)=>{const S=typeof n==="function"?n(c(),t):{...c(),...n};const U=a(S,C(t));const m=I(window.location.pathname,d);const E=`${m}${U.length?"?":""}${U}${window.location.hash}`;const $=`${m}${window.location.search}${window.location.hash}`;if(E===$)return;o(S);const{replace:q,...k}=h||{};w.current=[[q?"replace":"push",E,k]];clearTimeout(s);s=void 0;const u=w.current.filter(Boolean).at(-1);if(u){s=setTimeout(()=>{w.current=[];e[u[0]](u[1],u[2]);s=void 0},y.TIMEOUT)}},[e,a,c]);const g=v.default.useCallback(n=>{o(t);p(t,n)},[p,o]);return{updateState:o,updateUrl:p,state:f,reset:g,getState:c,pendingUrlUpdate:()=>s!==void 0}}function C(t){const e=Object.keys(t);const l=window.location.search;const d=new URLSearchParams(l);const r=new URLSearchParams;for(const[a,f]of d){!e.includes(a)&&r.set(a,f)}return r}function I(t,e){if(!e||e==="/"){return t}return t.slice(e.length)}exports.useUrlStateBase=B;
