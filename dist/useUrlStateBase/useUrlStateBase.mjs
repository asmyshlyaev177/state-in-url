import i from"react";import{TIMEOUT as T}from"../constants/constants.mjs";import{useInsertionEffect as b}from"../useInsertionEffect.mjs";import{useSharedState as v}from"../useSharedState/useSharedState.mjs";import{useUrlEncode as L}from"../useUrlEncode/useUrlEncode.mjs";import{filterUnknownParamsClient as P}from"../utils.mjs";function C(t,e,u,f){const{parse:r,stringify:s}=L(t);const{state:l,getState:c,setState:o}=v(t,()=>u?.({parse:r})||t);const m=i.useRef(void 0);b(()=>{const n=()=>{const p=r(P(t,q()));o(p)};window.addEventListener(g,n);return()=>{window.removeEventListener(g,n);clearTimeout(m.current)}},[o]);const a=i.useRef([]);const w=i.useCallback((n,p)=>{const h=typeof n==="function"?n(c()):{...c(),...n};const S=s(h,O(t));const $=I(window.location.pathname,f);const U=`${$}${S.length?"?":""}${S}${window.location.hash}`;const E=`${$}${window.location.search}${window.location.hash}`;if(U===E)return;o(h);const{replace:y,...R}=p||{};a.current.push([y?"replace":"push",U,R]);clearTimeout(m.current);queueMicrotask(()=>{if(!a.current.length)return;m.current=setTimeout(()=>{const d=a.current.at(-1);a.current=[];e[d[0]](d[1],d[2])},T)})},[e,s,c]);const k=i.useCallback(n=>{o(t);w(t,n)},[w,o]);return{updateState:o,updateUrl:w,state:l,reset:k,getState:c}}function O(t){const e=Object.keys(t);const u=window.location.search;const f=new URLSearchParams(u);const r=new URLSearchParams;for(const[s,l]of f){!e.includes(s)&&r.set(s,l)}return r}const g="popstate";function q(){return typeof window!=="undefined"&&window.location.search||""}function I(t,e){if(!e||e==="/"){return t}return t.slice(e.length)}export{C as useUrlStateBase};
