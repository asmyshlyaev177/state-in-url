import u from"react";import{TIMEOUT as y}from"../constants/constants.mjs";import{useInsertionEffect as L}from"../useInsertionEffect.mjs";import{useSharedState as T}from"../useSharedState/useSharedState.mjs";import{useUrlEncode as v}from"../useUrlEncode/useUrlEncode.mjs";import{filterUnknownParamsClient as R}from"../utils.mjs";function b(t,a,l){const{parse:c,stringify:r}=v(t),{state:s,getState:o,setState:n}=T(t,()=>l?.({parse:c})||t),w=u.useRef(void 0);L(()=>{const e=()=>{const m=c(R(t,P()));n(m)};return window.addEventListener(U,e),()=>{window.removeEventListener(U,e),clearTimeout(w.current)}},[n]);const i=u.useRef([]),f=u.useCallback((e,m)=>{const d=typeof e=="function"?e(o()):{...o(),...e},h=r(d,C(t)),S=`${window.location.pathname}${h.length?"?":""}${h}${window.location.hash}`,g=`${window.location.pathname}${window.location.search}${window.location.hash}`;if(S===g)return;n(d);const{replace:k,...E}=m||{};i.current.push([k?"replace":"push",S,E]),clearTimeout(w.current),queueMicrotask(()=>{i.current.length&&(w.current=setTimeout(()=>{const p=i.current.at(-1);i.current=[],a[p[0]](p[1],p[2])},y))})},[a,r,o]),$=u.useCallback(e=>{n(t),f(t,e)},[f,n]);return{updateState:n,updateUrl:f,state:s,reset:$,getState:o}}function C(t){const a=Object.keys(t),l=window.location.search,c=new URLSearchParams(l),r=new URLSearchParams;for(const[s,o]of c)!a.includes(s)&&r.set(s,o);return r}const U="popstate";function P(){return typeof window<"u"&&window.location.search||""}export{b as useUrlStateBase};
