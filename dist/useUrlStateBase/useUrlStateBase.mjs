import u from"react";import{TIMEOUT as T}from"../constants/constants.mjs";import{useInsertionEffect as b}from"../useInsertionEffect.mjs";import{useSharedState as v}from"../useSharedState/useSharedState.mjs";import{useUrlEncode as L}from"../useUrlEncode/useUrlEncode.mjs";import{filterUnknownParamsClient as P}from"../utils.mjs";function C(t,e,o,f){const{parse:s,stringify:c}=L(t);const{state:l,getState:a,setState:r}=v(t,()=>o?.({parse:s})||t);const w=u.useRef(void 0);b(()=>{const n=()=>{const p=s(P(t,q()));r(p)};window.addEventListener(g,n);return()=>{window.removeEventListener(g,n);clearTimeout(w.current)}},[r]);const i=u.useRef([]);const m=u.useCallback((n,p)=>{const h=typeof n==="function"?n(a()):{...a(),...n};const S=c(h,O(t));const $=I(window.location.pathname,f);const U=`${$}${S.length?"?":""}${S}${window.location.hash}`;const E=`${$}${window.location.search}${window.location.hash}`;if(U===E)return;r(h);const{replace:y,...R}=p||{};i.current.push([y?"replace":"push",U,R]);clearTimeout(w.current);queueMicrotask(()=>{if(!i.current.length)return;w.current=setTimeout(()=>{const d=i.current.at(-1);i.current=[];e[d[0]](d[1],d[2])},T)})},[e,c,a]);const k=u.useCallback(n=>{r(t);m(t,n)},[m,r]);return{updateState:r,updateUrl:m,state:l,reset:k,getState:a}}function O(t){const e=Object.keys(t);const o=window.location.search;const f=new URLSearchParams(o);const s=new URLSearchParams;for(const[c,l]of f){!e.includes(c)&&s.set(c,l)}return s}const g="popstate";function q(){return typeof window!=="undefined"&&window.location.search||""}function I(t,e){if(!e||e==="/"){return t}const o=t.slice(e.length);return o.startsWith("/")?o:"/"+o}export{C as useUrlStateBase};
